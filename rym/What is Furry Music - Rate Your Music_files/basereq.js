function trim(t){for(;t.length>0&&t[0]==" ";)t=t.substr(1);for(;t.length>1&&t[length-1]==" ";)t=t.substr(0,t.length-2);return t}function setChild(t,e,n){for(var r=e.childNodes,i=0;i<r.length;i++){try{var l=r[i].id;l&&(r[i].id=t+l+n)}catch(a){}setChild(t,r[i],n)}}var counter=0;function divClone(t,e,n){var r=document.getElementById(e).cloneNode(!0);counter++,document.getElementById(t+"num").value=counter,r.id=t+counter;var i=r.childNodes;r.style.display="",setChildNodes(t,r,counter);var l=document.getElementById(n);l.parentNode.insertBefore(r,l),did("prefixtable")&&prettify("prefixtable")}function clearAllRows(t){for(var e=0;e<=counter;e++)deleteRow(t,t+"_"+e);counter=0}function deleteRow(t,e){e=e.split("_"),e=e[e.length-1];var n=document.getElementById(t+e);if(n){n.parentNode.removeChild(n);var r=document.getElementById(t+"location");r&&r.innerHTML&&(r.innerHTML="")}did("prefixtable")&&prettify("prefixtable")}var g_processUrl=g_processUrl||"/go/process";function setProcessUrl(t){g_processUrl=t}function did(t){return document.getElementById(t)}function sendRequest(t){var e=did("loading");e&&(e.src="/images/loading.gif"),req=new XMLHttpRequest,req.onreadystatechange=processReqChange,req.open("POST",g_processUrl,!0),req.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),req.send("action="+t)}function processReqChange(){if(req&&req.readyState==4){eval(req.responseText);var el=did("loading");el&&(el.src="/images/blank.png")}}function submitPreview(t){var e="/go/processpreview";if(req=!1,window.XMLHttpRequest)try{req=new XMLHttpRequest}catch(n){req=!1}else if(window.ActiveXObject)try{req=new ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{req=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){req=!1}}req&&(req.onreadystatechange=processReqChange,req.open("POST",e,!0),req.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),req.send("id="+t+"&text="+encodeURIComponent(did(t).value)))}function initSortableTables(){$.each($(".mbgen"),function(){var t=$(this).attr("id");!t||(header=$("#"+t).find("th").filter(function(e){return this.index=e+1,e in{0:0,1:0,3:0,4:0,6:0}}),$.each(header,function(){var e=1;$(this).css("cursor","pointer").css("text-decoration","underline"),$(this).click(function(n){sortRows(t,this.index,e),e*=-1})}))})}function sortRows(t,e,n){var r=$("#"+t).children().children("tr[id^=tr]"),i="number";$.each(r,function(){isNaN(Number($(this).children(":nth-child("+e+")").text().replace(",","")))&&(i="text")});var l=$.map(r,function(a){var o=$(a).children(":nth-child("+e+")").text().replace(/[ '":;,]/g,"").replace(String.fromCharCode(160),"");return{row:$(a).html(),cell:i=="text"?o:Number(o),className:$(a).attr("class"),display:$(a).css("display")}});l.sort(function(a,o){return n==-1&&(a.cell||(a.cell=i=="number"?Infinity:"ZZZZZZ"),o.cell||(o.cell=i=="number"?Infinity:"ZZZZZZ")),a.cell<o.cell?1*n:a.cell>o.cell?-1*n:0}),$.each(r,function(){var a=l.shift();$(this).html(a.row),$(this).attr("class",a.className),$(this).css("display",a.display)})}function prettify(t){t=="casts"&&(t="cast_members"),t=="crews"&&(t="crew_members");for(var e=darkcolors[t],n=lightcolors[t],r=document.getElementById(t).getElementsByTagName("tr"),i=r.length,l=0,a=1;a<i;a++){var o=r[a];if(o.style&&o.style.display!="none"){l=!l,o.style.background=l?e:n;for(var d=o.getElementsByTagName("td"),u=d.length,c=1;c<i;c++){var s=d[c];s&&s.getElementsByTagName("input")&&s.getElementsByTagName("input")[0]&&(s.getElementsByTagName("input")[0].style.background=l?e:n)}}}}var Position=function(){function t(n){if(document.getElementById&&document.getElementById(n)!=null)return document.getElementById(n);if(document.all&&document.all[n]!=null)return document.all[n];if(document.anchors&&document.anchors.length&&document.anchors.length>0&&document.anchors[0].x){for(var r=0;r<document.anchors.length;r++)if(document.anchors[r].name==n)return document.anchors[r]}}var e={};return e.$VERSION=1,e.set=function(n,r,i){if(typeof n=="string"&&(n=t(n)),n==null||!n.style)return!1;if(typeof r=="object"){var l=r;r=l.left,i=l.top}return n.style.left=r+"px",n.style.top=i+"px",!0},e.get=function(n){var r=!0;if(typeof n=="string"&&(n=t(n)),n==null)return null;var i=0,l=0,a=0,o=0,d=null,u=null;u=n.offsetParent;for(var c=n,s=n;s.parentNode!=null;){if(s=s.parentNode,s.offsetParent!=null){var f=!0;r&&window.opera&&(s==c.parentNode||s.nodeName=="TR")&&(f=!1),f&&(s.scrollTop&&s.scrollTop>0&&(l-=s.scrollTop),s.scrollLeft&&s.scrollLeft>0&&(i-=s.scrollLeft))}s==u&&(i+=n.offsetLeft,s.clientLeft&&s.nodeName!="TABLE"&&(i+=s.clientLeft),l+=n.offsetTop,s.clientTop&&s.nodeName!="TABLE"&&(l+=s.clientTop),n=s,n.offsetParent==null&&(n.offsetLeft&&(i+=n.offsetLeft),n.offsetTop&&(l+=n.offsetTop)),u=n.offsetParent)}return c.offsetWidth&&(a=c.offsetWidth),c.offsetHeight&&(o=c.offsetHeight),{left:i,top:l,width:a,height:o}},e.getCenter=function(n){var r=this.get(n);return r==null?null:(r.left=r.left+r.width/2,r.top=r.top+r.height/2,r)},e}();function toggleSub(t,e,n,r,i){did("sub_"+t+"_"+e+"_"+n).src="/images/loading.gif",sendRequest("Subscription|"+token+"|"+t+"|"+e+"|"+n+"|"+r)}function toggleFav(t,e,n,r){did("fav_"+t+"_"+e+"_"+n).src="/images/loading.gif",sendRequest("Favorite|"+token+"|"+t+"|"+e+"|"+n)}function minidoc_update(t,e){var n=encodeURIComponent(did("minidoc_body_ta_"+t).value);sendRequest("Minidoc|"+token+"|"+t+"|"+e+"|"+n)}function tagClick(t,e,n,r){if(token!=""){var i=-1;current_id=e;var l=document.getElementById("tagger1");l.style.position="absolute";var a=did("tag_img_"+e+"_"+n+"_"+r),o=Position.get(a);l.style.top=o.top+o.height+"px",l.style.left=o.left-200+"px",l.style.visibility="visible",did("tagger_assoc_id").value=e,did("tagger_type").value=n,did("tagger_context").value=r,sendRequest("LoadTags|"+token+"|"+e+"|"+n+","+r+","+i),setOverlay(!0)}}var g_spellingList=null,g_type="a",g_lastId=null;function goLink(t){g_type=="a"?pnhTextareaInsert(g_lastId,"","[Artist"+t+"]"):g_type=="l"?pnhTextareaInsert(g_lastId,"","[Album"+t+"]"):g_type=="b"&&pnhTextareaInsert(g_lastId,"","[Label"+t+"]"),cancelSearch(g_lastId)}function initTextarea(t){did(t+"_preview").style.display="none",setButtons("normal",t),did("ta_searchfields_"+t).style.display="none"}function startSearch(t,e){did("ta_searchfields_"+t).style.display="",g_type=e,did("searchname_"+t).value="";for(var n=did("ta_search_instruct_"+t);n.hasChildNodes();)n.removeChild(n.firstChild);var r;e=="a"?r="Type artist's name":e=="l"?r="First, search for the artist :":e=="b"&&(r="Type label name"),n.appendChild(document.createTextNode(r))}function cancelSearch(t){did("ta_searchfields_"+t).display="none";var e=did("searchbox"+t);e.style.height="1px",e.style.width="1px",e.style.visibility="hidden",e.src="/go/search?ta&searchterm=&searchtype=",did("ta_searchfields_"+t).style.display="none"}function goSearch(t){var e=did("searchbox"+t);e.style.top="0",e.style.left="0",e.style.height="200px",e.style.width="415px",e.style.visibility="visible",e.src="/go/search?ta&searchterm="+escape(did("searchname_"+t).value)+"&searchtype="+(g_type=="l"?"a":g_type)+"&searchdest="+g_type,g_lastId=t}function replaceWord(t,e,n){pnhTextareaReplace(n,"",g_spellingList[e][t])}function setButtons(t,e){var n,r;t=="normal"?(r=new Array("ta_bold_"+e,"ta_italic_"+e,"ta_link_"+e,"ta_connectArtist_"+e,"ta_connectRelease_"+e,"ta_connectLabel_"+e,"ta_connectText_"+e,"reviewsavebtn","ta_spellcheck_"+e,"ta_preview_btn_"+e,"ta_submit_"+e),n=new Array("ta_cancelpreview_btn_"+e)):t=="preview"&&(cancelSearch(e),n=new Array("ta_bold_"+e,"ta_italic_"+e,"ta_link_"+e,"ta_connectArtist_"+e,"ta_connectRelease_"+e,"ta_connectLabel_"+e,"ta_connectText_"+e,"reviewsavebtn","ta_spellcheck_"+e,"ta_preview_btn_"+e,"ta_submit_"+e),r=new Array("ta_cancelpreview_btn_"+e));for(var e in n){var i=did(n[e]);i&&(i.style.visibility="hidden")}for(var e in r){var i=did(r[e]);i&&(i.style.visibility="visible")}}function cancelPreview(t){setButtons("normal",t),did(t+"_preview").style.display="none"}function previewO(t){did(t+"_preview").innerHTML='Loading preview... <img src="/images/loading.gif">',did(t+"_preview").style.display="",submitPreview(t)}function preview(t){setButtons("preview",t),did(t+"_preview").innerHTML='Loading preview... <img src="/images/loading.gif">',did(t+"_preview").style.display="",submitPreview(t)}function hidePopup(t){did("popupblanket").style.display="none",did(t).style.display="none"}function showPopup(t,e,n){viewport=getViewportDimensions();var r=Math.round((viewport[0]-e)/2),i=Math.round((viewport[1]-n)/2);did(t).style.width=e+"px",did(t).style.height=n+"px",did(t).style.marginTop=-(n/2)+"px",did(t).style.marginLeft=-(e/2)+"px",did("popupblanket").style.display="block",did(t).style.display="block"}function getViewportDimensions(){var t=0,e=0;return typeof window.innerWidth=="number"?(t=window.innerWidth,e=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)&&(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight),new Array(t,e)}function pnhTextareaReplace(t,e){var n=document.getElementById(t);if(document.selection){var r=document.selection.createRange().text;n.focus();var i=document.selection.createRange();i.text=e}else if(n.selectionStart|n.selectionStart==0){n.selectionEnd>n.value.length&&(n.selectionEnd=n.value.length);var l=n.selectionStart,a=n.selectionEnd+e.length;n.value=n.value.slice(0,l)+e+n.value.slice(n.selectionEnd),n.selectionStart=l+e.length,n.selectionEnd=a,n.focus()}}function pnhTextareaInsert(t,e,n){var r=document.getElementById(t),i=r.scrollTop;if(document.selection){var l=document.selection.createRange().text;r.focus();var a=document.selection.createRange();a.text=e+l+n}else if(r.selectionStart|r.selectionStart==0){r.selectionEnd>r.value.length&&(r.selectionEnd=r.value.length);var o=r.selectionStart,d=r.selectionEnd+e.length;r.value=r.value.slice(0,o)+e+r.value.slice(o),r.value=r.value.slice(0,d)+n+r.value.slice(d),r.selectionStart=o+e.length,r.selectionEnd=d,r.focus()}r.scrollTop=i}function pnhEditTextarea(t,e){var n="",r="";switch(e){case"strong":n="[b]",r="[/b]";break;case"emphasis":n="[i]",r="[/i]";break;case"a_href":var i=prompt("Please enter the site you'd like to link","http://"),l=prompt("Please enter the name of this link","");i!=null&&l!=null?(n="["+i+","+l+"]",r=""):(n="",r="");break}return pnhTextareaInsert(t,n,r),!1}
